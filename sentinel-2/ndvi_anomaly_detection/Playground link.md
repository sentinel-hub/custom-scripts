https://apps.sentinel-hub.com/sentinel-playground-temporal/?source=S2&lat=51.20451728688966&lng=12.607498168945312&zoom=11&preset=CUSTOM&layers=B01,B02,B03&maxcc=30&gain=1.0&gamma=1.0&time=2015-01-01%7C2018-08-31&atmFilter=&showDates=false&evalscript=Ly9WRVJTSU9OPTMgKGF1dG8tY29udmVydGVkIGZyb20gMSkKLyoKQXV0aG9yOiBKZWFuLUJhcHRpc3RlIFBsZXluZXQKKi8KCmNvbnN0IGNvbmZpZzIgPSB7CiAgZGVmYXVsdDogewogICAgbmJQYXN0WWVhcnM6IDMsCiAgICBkZWZhdWx0T3V0cHV0VmFsdWU6IC0yLAogICAgbmR2aU1pblZhbHVlOiAtMSwKICAgIGN1cnJlbnRJbmRleGVzTWluVmFsdWVzTnVtYmVyOiAxLAogICAgcGFzdEluZGV4ZXNNaW5WYWx1ZXNOdW1iZXI6IDMKICB9LAogIG5kdmlBbm9tYWx5OiB7CiAgICBwaXhlbEV2YWxNYXhWYWx1ZTogMC43CiAgfSwKICBsb3NzOiB7CiAgICBsb3dlclRyaWdnZXJQcmVtaXVtOiAwLAogICAgaGlnaGVyVHJpZ2dlclByZW1pdW06IDEsCiAgICBtaW5pbXVtQXZlcmFnZVZhbHVlUHJlbWl1bTogMC4xLAogICAgbWluaW11bVBheW91dFByZW1pdW06IDAKICB9Cn07CgpmdW5jdGlvbiBzZXR1cCgpIHsKICByZXR1cm4gewogICAgaW5wdXQ6IFt7CiAgICAgIGJhbmRzOiBbCiAgICAgICAgICAiQjA0IiwKICAgICAgICAgICJCMDgiCiAgICAgIF0KICAgIH1dLAogICAgb3V0cHV0OiB7IGJhbmRzOiAzIH0sCiAgICBtb3NhaWNraW5nOiAiT1JCSVQiCiAgfQp9CjsKCnZhciBmaWx0ZXJTY2VuZXMgPSBmdW5jdGlvbiBmaWx0ZXJTY2VuZXMoc2NlbmVzLCBtZXRhZGF0YUlucHV0KSB7CiAgY29uc3QgbmJQYXN0WWVhcnMgPSBjb25maWcyLmRlZmF1bHQubmJQYXN0WWVhcnM7CiAgcmV0dXJuIHNjZW5lcy5maWx0ZXIoZnVuY3Rpb24gKHNjZW5lKSB7CiAgICByZXR1cm4gc2NlbmUuZGF0ZS5nZXRNb250aCgpID09PSBtZXRhZGF0YUlucHV0LnRvLmdldE1vbnRoKCkgJiYgc2NlbmUuZGF0ZS5nZXRGdWxsWWVhcigpID49IG1ldGFkYXRhSW5wdXQudG8uZ2V0RnVsbFllYXIoKSAtIG5iUGFzdFllYXJzOwogIH0pOwp9OwoKCmZ1bmN0aW9uIGNhbGN1bGF0ZUxvc3MoY3VycmVudEluZGV4QXZlcmFnZSwgcGFzdEluZGV4QXZlcmFnZSwgbWluaW11bUF2ZXJhZ2VWYWx1ZVByZW1pdW0sIGxvd2VyVHJpZ2dlclByZW1pdW0sIGhpZ2hlclRyaWdnZXJQcmVtaXVtLCBtaW5pbXVtUGF5b3V0UHJlbWl1bSwgZGVmYXVsdFZhbHVlKSB7CiAgaWYgKGN1cnJlbnRJbmRleEF2ZXJhZ2UgPT09IG51bGwgfHwgcGFzdEluZGV4QXZlcmFnZSA9PT0gbnVsbCkgcmV0dXJuIGRlZmF1bHRWYWx1ZTsKICBpZiAocGFzdEluZGV4QXZlcmFnZSA8IG1pbmltdW1BdmVyYWdlVmFsdWVQcmVtaXVtIHx8IHBhc3RJbmRleEF2ZXJhZ2UgPD0gY3VycmVudEluZGV4QXZlcmFnZSkgcmV0dXJuIDA7CiAgdmFyIHBlcmNlbnRhZ2UgPSAocGFzdEluZGV4QXZlcmFnZSAtIGN1cnJlbnRJbmRleEF2ZXJhZ2UpIC8gcGFzdEluZGV4QXZlcmFnZTsKICBpZiAocGVyY2VudGFnZSA8IGxvd2VyVHJpZ2dlclByZW1pdW0pIHJldHVybiAwOwogIGlmIChwZXJjZW50YWdlID4gaGlnaGVyVHJpZ2dlclByZW1pdW0pIHJldHVybiAxOwogIHJldHVybiBNYXRoLm1heChtaW5pbXVtUGF5b3V0UHJlbWl1bSwgKHBlcmNlbnRhZ2UgLSAobG93ZXJUcmlnZ2VyUHJlbWl1bSAtIG1pbmltdW1QYXlvdXRQcmVtaXVtKSkgLyBoaWdoZXJUcmlnZ2VyUHJlbWl1bSk7Cn07Cgp2YXIgY2FsY3VsYXRlTmR2aUFub21hbHkgPSBmdW5jdGlvbiBjYWxjdWxhdGVOZHZpQW5vbWFseShpbmRleGVzQXZlcmFnZXMsIHBpeGVsRXZhbE1heFZhbHVlLCBkZWZhdWx0VmFsdWUpIHsKICBpZiAoaW5kZXhlc0F2ZXJhZ2VzLmN1cnJlbnQgPT09IG51bGwgfHwgaW5kZXhlc0F2ZXJhZ2VzLnBhc3QgPT09IG51bGwpIHJldHVybiBkZWZhdWx0VmFsdWU7CiAgcmV0dXJuIE1hdGgubWF4KE1hdGgubWluKGluZGV4ZXNBdmVyYWdlcy5jdXJyZW50IC0gaW5kZXhlc0F2ZXJhZ2VzLnBhc3QsIHBpeGVsRXZhbE1heFZhbHVlKSwgMCAtIHBpeGVsRXZhbE1heFZhbHVlKTsKfTsKCnZhciBjYWxjdWxhdGVORFZJID0gZnVuY3Rpb24gY2FsY3VsYXRlTkRWSShzYW1wbGUsIGNvbmZpZykgewogIHZhciBkZW5vbSA9IHNhbXBsZS5CMDQgKyBzYW1wbGUuQjA4OwogIGlmIChkZW5vbSA9PT0gMCkgcmV0dXJuIG51bGw7CiAgdmFyIHJlc3VsdCA9IChzYW1wbGUuQjA4IC0gc2FtcGxlLkIwNCkgLyBkZW5vbTsKICByZXR1cm4gcmVzdWx0ID4gY29uZmlnLm5kdmlNaW5WYWx1ZSA%2FIHJlc3VsdCA6IG51bGw7Cn07Cgpjb25zdCBldmFsdWF0ZVBpeGVsID0gZnVuY3Rpb24gKHNhbXBsZXMsIHNjZW5lcykgewogIHZhciBpbmRleGVzQXZlcmFnZXMgPSBjYWxjdWxhdGVJbmRleEF2ZXJhZ2VzKHNhbXBsZXMsIHNjZW5lcywgY29uZmlnMlsiZGVmYXVsdCJdLCBjYWxjdWxhdGVORFZJKTsKICByZXR1cm4gY29sb3JCbGVuZChjYWxjdWxhdGVOZHZpQW5vbWFseShpbmRleGVzQXZlcmFnZXMsIGNvbmZpZzIubmR2aUFub21hbHkucGl4ZWxFdmFsTWF4VmFsdWUsIGNvbmZpZzJbImRlZmF1bHQiXS5kZWZhdWx0T3V0cHV0VmFsdWUpLCBbY29uZmlnMlsiZGVmYXVsdCJdLmRlZmF1bHRPdXRwdXRWYWx1ZSwgMCAtIGNvbmZpZzIubmR2aUFub21hbHkucGl4ZWxFdmFsTWF4VmFsdWUsIDAsIGNvbmZpZzIubmR2aUFub21hbHkucGl4ZWxFdmFsTWF4VmFsdWVdLCBbWzAsIDAsIDBdLCBbMSwgMCwgMF0sIFsxLCAxLCAxXSwgWzAsIDEsIDBdXSk7Cn07Cgp2YXIgaXNDbG91ZHMgPSBmdW5jdGlvbiBpc0Nsb3VkcyhzYW1wbGUpIHsKICB2YXIgbmdkciA9IChzYW1wbGUuQjAzIC0gc2FtcGxlLkIwNCkgLyAoc2FtcGxlLkIwMyArIHNhbXBsZS5CMDQpOwogIHZhciByYXRpbyA9IChzYW1wbGUuQjAzIC0gMC4xNzUpIC8gKDAuMzkgLSAwLjE3NSk7CiAgcmV0dXJuIHNhbXBsZS5CMTEgPiAwLjEgJiYgKHJhdGlvID4gMSB8fCByYXRpbyA%2BIDAgJiYgbmdkciA%2BIDApOwp9OwoKdmFyIGNhbGN1bGF0ZUluZGV4ZXNGb3JTYW1wbGVzID0gZnVuY3Rpb24gY2FsY3VsYXRlSW5kZXhlc0ZvclNhbXBsZXMoc2FtcGxlcywgc2NlbmVzLCBjb25maWcsIHByb2Nlc3NTYW1wbGVNZXRob2QpIHsKICBpZiAoc2FtcGxlcy5sZW5ndGggIT09IHNjZW5lcy5sZW5ndGgpIHRocm93IG5ldyBFcnJvcignc2FtcGxlcyBhbmQgc2NlbmVzIGFycmF5cyBkbyBub3QgaGF2ZSBzYW1lIGxlbmd0aCcpOwogIHJldHVybiBzYW1wbGVzLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBzYW1wbGUsIGluZGV4KSB7CiAgICBpZiAoaXNDbG91ZHMoc2FtcGxlKSkgcmV0dXJuIGFjYzsKICAgIHZhciBpbmRleFZhbHVlID0gcHJvY2Vzc1NhbXBsZU1ldGhvZChzYW1wbGUsIGNvbmZpZyk7CiAgICBpZiAoIWluZGV4VmFsdWUpIHJldHVybiBhY2M7CiAgICB2YXIgc2NlbmVZZWFyID0gc2NlbmVzW2luZGV4XS5kYXRlLmdldEZ1bGxZZWFyKCk7CgogICAgaWYgKCFhY2Nbc2NlbmVZZWFyXSkgewogICAgICBhY2Nbc2NlbmVZZWFyXSA9IHsKICAgICAgICBjb3VudDogMCwKICAgICAgICBzdW06IDAKICAgICAgfTsKICAgIH0KCiAgICBhY2Nbc2NlbmVZZWFyXS5jb3VudCsrOwogICAgYWNjW3NjZW5lWWVhcl0uc3VtICs9IGluZGV4VmFsdWU7CiAgICByZXR1cm4gYWNjOwogIH0sIHt9KTsKfTsKCnZhciBjYWxjdWxhdGVQYXN0SW5kZXhlc0F2ZXJhZ2UgPSBmdW5jdGlvbiBjYWxjdWxhdGVQYXN0SW5kZXhlc0F2ZXJhZ2UoaW5kZXhlcywgY3VycmVudFllYXIsIGNvbmZpZykgewogIHZhciBwYXN0SW5kZXhlcyA9IHsKICAgIGNvdW50OiAwLAogICAgc3VtOiAwCiAgfTsKCiAgZm9yICh2YXIgaSA9IDE7IGkgPD0gY29uZmlnLm5iUGFzdFllYXJzOyBpKyspIHsKICAgIHZhciBpbmRleFZhbHVlID0gaW5kZXhlc1tjdXJyZW50WWVhciAtIGldOwoKICAgIGlmIChpbmRleFZhbHVlICYmIGluZGV4VmFsdWUuY291bnQpIHsKICAgICAgcGFzdEluZGV4ZXMuY291bnQrKzsKICAgICAgcGFzdEluZGV4ZXMuc3VtICs9IGluZGV4VmFsdWUuc3VtIC8gaW5kZXhWYWx1ZS5jb3VudDsKICAgIH0KICB9CgogIHJldHVybiBwYXN0SW5kZXhlcy5jb3VudCA%2BPSBjb25maWcucGFzdEluZGV4ZXNNaW5WYWx1ZXNOdW1iZXIgPyBwYXN0SW5kZXhlcy5zdW0gLyBwYXN0SW5kZXhlcy5jb3VudCA6IG51bGw7Cn07CgpmdW5jdGlvbiBjYWxjdWxhdGVJbmRleEF2ZXJhZ2VzKHNhbXBsZXMsIHNjZW5lcywgY29uZmlnLCBwcm9jZXNzU2FtcGxlTWV0aG9kKSB7CiAgaWYgKCFzY2VuZXMubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoJ3NjZW5lcyBhcnJheSBpcyBlbXB0eScpOwogIHZhciBpbmRleGVzID0gY2FsY3VsYXRlSW5kZXhlc0ZvclNhbXBsZXMoc2FtcGxlcywgc2NlbmVzLCBjb25maWcsIHByb2Nlc3NTYW1wbGVNZXRob2QpOwogIHZhciBjdXJyZW50WWVhciA9IHNjZW5lc1swXS5kYXRlLmdldEZ1bGxZZWFyKCk7CiAgdmFyIGN1cnJlbnRZZWFySW5kZXggPSBpbmRleGVzW2N1cnJlbnRZZWFyXTsKICByZXR1cm4gewogICAgY3VycmVudDogY3VycmVudFllYXJJbmRleCAmJiBjdXJyZW50WWVhckluZGV4LmNvdW50ID49IGNvbmZpZy5jdXJyZW50SW5kZXhlc01pblZhbHVlc051bWJlciAmJiBjdXJyZW50WWVhckluZGV4LnN1bSAvIGN1cnJlbnRZZWFySW5kZXguY291bnQgfHwgbnVsbCwKICAgIHBhc3Q6IGNhbGN1bGF0ZVBhc3RJbmRleGVzQXZlcmFnZShpbmRleGVzLCBjdXJyZW50WWVhciwgY29uZmlnKQogIH07Cn07Cg%3D%3D&temporal=true